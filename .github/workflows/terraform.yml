name: "Terraform modules"

on:
  workflow_dispatch:
  pull_request:

jobs:
  terraform:
    name: "Terraform"
    runs-on: ubuntu-latest
    steps:
      - name: Set up OpenTofu
        uses: opentofu/setup-opentofu@v1
        with:
          tofu_version: latest

      - name: Checkout
        uses: actions/checkout@v5

      - name: Format
        run: tofu fmt -check -recursive .

      - name: Initialize
        run: tofu init -backend=false

      - name: Validate
        run: tofu validate

  checkov:
    name: "Checkov"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Checkov
        uses: bridgecrewio/checkov-action@v12
        with:
          framework: terraform
